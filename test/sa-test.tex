\listfiles
\documentclass{article}
\usepackage{scrbase}


\begin{document}
\makeatletter
\def\SVG@in@end{\begin{document}}%
\begingroup
  \newif\if@svg@convert@classfound
  \def\svg@convert@documentclass#1\documentclass#2\documentclass#3\@nil{%
    \IfArgIsEmpty{#2}{}{%
      \def\svg@tempa{\@ifnextchar[{\svg@tempb}{\svg@tempb[]}}%]
      \def\svg@tempb[##1]##2\@nil{%
        \IfArgIsEmpty{##1}{%
          \def\SVG@in@line{\documentclass[class=##2]{standalone}}%
        }{%
          \def\SVG@in@line{\documentclass[class=##2,##1]{standalone}}%
        }%
      }%
      \svg@tempa#2\@nil%
      \@svg@convert@classfoundtrue%
    }%
  }
  \def\svg@convert@endpreamble#1\@nil{%
    \def\svg@tempa##1{%
      \def\svg@tempa####1##1####2##1####3\@nil{%
        \IfArgIsEmpty{####3}{}{%
          \IfArgIsEmpty{####1}{\@tempswafalse}{\def\SVG@in@line{####1}}%
          \SVG@in@readfalse%
        }%
      }%
    }%
    \edef\svg@tempb{\expandafter\detokenize\expandafter{\SVG@in@end}}%
    \expandafter\svg@tempa\expandafter{\svg@tempb}%
    \edef\svg@tempb{\detokenize{#1}\svg@tempb\svg@tempb}%
    \expandafter\svg@tempa\svg@tempb\@nil%
  }
    \endlinechar=\m@ne%
    \newwrite\SVG@out@file%
    \def\SVG@out@filename{extract.tex}%
    \immediate\openout\SVG@out@file=\SVG@out@filename%
    \def\SVG@in@line{}%
    \newread\SVG@in@file%
    \immediate\openin\SVG@in@file=includesvg.tex%
    \newif\ifSVG@in@read%
    \SVG@in@readtrue
    \@tempswafalse%
    \@whilesw\ifSVG@in@read\fi{%
      \immediate\read\SVG@in@file to\SVG@in@line%
      \ifx\SVG@in@line\@empty%
        \@tempswafalse
        \ifeof\SVG@in@file\SVG@in@readfalse\fi%
      \else%
        \@tempswatrue%
      \fi%
      \expandafter\svg@convert@endpreamble\SVG@in@line\@nil%
      \if@tempswa%
        \expandafter\svg@convert@documentclass%
          \SVG@in@line\documentclass\documentclass\@nil%
        \immediate\write\SVG@out@file{\unexpanded\expandafter{\SVG@in@line}}%
      \fi%
    }%
    \immediate\closein\SVG@in@file%
    \immediate\closeout\SVG@out@file%
    % TODO PassOptionsToClass und Lualatex-kram
    \if@svg@convert@classfound\else%
      \immediate\openin\SVG@in@file=\SVG@out@filename
      \def\svg@tempa{}
      \loop\unless\ifeof\SVG@in@file%
        \readline\SVG@in@file to\SVG@in@line%
        \ifx\SVG@in@line\@empty\else%
          \edef\svg@tempa{%
            \unexpanded\expandafter{\svg@tempa}%
            \unexpanded\expandafter{\SVG@in@line}^^J%
          }%
        \fi%
      \repeat%
      \closein\SVG@in@file%
      \immediate\openout\SVG@out@file=\SVG@out@filename
      \immediate\write\SVG@out@file{\noexpand\documentclass{standalone}}%
      \immediate\write\SVG@out@file{\unexpanded\expandafter{\svg@tempa}}%
      \closeout\SVG@out@file%
    \fi%
\endgroup
\makeatother


test
\end{document}


%\documentclass[class=tudscrartcl,cdfonts=false]{standalone}
%\usepackage[T1]{fontenc}
%\usepackage{svg-new}
%\usepackage{amsmath}
%\begin{document}
%\newincludesvg[width=\textwidth]{newimage}%
%\end{document}
